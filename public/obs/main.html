<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>情報画面</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Kosugi&family=Shippori+Mincho+B1:wght@400;600&family=Yuji+Syuku&family=Zen+Antique+Soft&display=swap"
        rel="stylesheet">

    <style>
        html {
            background-color: transparent;
        }
        
        body {
            margin: 0;
            overflow: hidden;
        }

        main {
            position: relative;
            background-image: url(image/真打メイン画面.png);
            width: 1920px;
            height: 1080px;
            background-repeat: no-repeat;
        }

        /* --- 画像切り替えエリア (右下) --- */
        #rotating-image-container {
            position: absolute;
            left: 1680px;
            top: 860px;
            width: 200px;
            height: 200px;
        }

        .slide-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        .slide-img.active {
            opacity: 1;
        }

        /* --- 左側：縦書きタイトルエリア --- */
        #page-title-area {
            position: absolute;
            left: 30px;
            top: 130px;
            width: 100px;
            height: 850px;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* 上寄せ */
            pointer-events: none; /* クリックを透過 */
        }

        #page-title-text {
            writing-mode: vertical-rl; /* 縦書き */
            font-family: 'Yuji Syuku', serif;
            font-size: 64px;
            font-weight: bold;
            color: #333;
            letter-spacing: 0.2em;
            text-shadow: 
                2px 2px 0 #fff,
                -1px -1px 0 #fff,
                1px -1px 0 #fff,
                -1px 1px 0 #fff,
                1px 1px 0 #fff;
            transition: opacity 0.5s;
        }

        /* --- コンテンツエリア (iframe) --- */
        #content-frame {
            position: absolute;
            left: 140px;
            top: 100px;
            width: 1500px;
            height: 910px;
            border: none;
            background-color: transparent;
        }

    </style>
</head>

<body>
    <main>
        <div id="page-title-area">
            <div id="page-title-text">対戦情報</div>
        </div>

        <iframe id="content-frame" src="match-info.html" allowtransparency="true"></iframe>

        <div id="rotating-image-container">
            <img src="image/大学杯QR.png" class="slide-img active" alt="QRコード">
            <img src="image/大学杯真打ロゴ.png" class="slide-img" alt="ロゴ">
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAotBKDxazOEtOv_IzoqW9bNPQXaz7a3vA",
            authDomain: "daigakuhai-support-fb.firebaseapp.com",
            projectId: "daigakuhai-support-fb",
            storageBucket: "daigakuhai-support-fb.firebasestorage.app",
            messagingSenderId: "939931798179",
            appId: "1:939931798179:web:8320fba89104e81f47cd16"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const broadcastRef = doc(db, "state", "broadcast");

        // --- 画像切り替えスクリプト (8秒) ---
        const images = document.querySelectorAll('.slide-img');
        let currentImgIndex = 0;

        setInterval(() => {
            images[currentImgIndex].classList.remove('active');
            currentImgIndex = (currentImgIndex + 1) % images.length;
            images[currentImgIndex].classList.add('active');
        }, 12000);


        // --- 画面切り替えロジック ---
        
        // オペレーションIDと表示テキスト、URLの対応表
        const pages = {
            'main-matchup': { title: '対戦情報', url: 'match-info.html' },
            'main-alpha':   { title: 'アルファチーム詳細', url: 'alpha-detail.html' },
            'main-bravo':   { title: 'ブラボーチーム詳細', url: 'bravo-detail.html' },
            'main-stage':   { title: 'ステージ', url: 'stage-info.html' }
        };

        const titleEl = document.getElementById('page-title-text');
        const iframeEl = document.getElementById('content-frame');

        function updateDisplay(opCode) {
            const pageData = pages[opCode] || pages['main-matchup'];
            
            // タイトル更新
            titleEl.style.opacity = 0;
            setTimeout(() => {
                titleEl.textContent = pageData.title;
                titleEl.style.opacity = 1;
            }, 300); // フェード切り替え

            // iframe更新
            if (iframeEl.getAttribute('src') !== pageData.url) {
                iframeEl.src = pageData.url;
            }
        }

        // Firestoreの変更を検知
        onSnapshot(broadcastRef, (docSnap) => {
            if (docSnap.exists()) {
                const data = docSnap.data();
                const mainOp = data.mainOp;
                updateDisplay(mainOp);
            }
        });
    </script>
</body>
</html>